<Window x:Class="AnalysisWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:MoneyMind.Converters"
        Title="ðŸ“Š Analisi Avanzate - MoneyMind"
        Height="720" Width="1100"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}"
        FontFamily="Segoe UI">

    <Window.Resources>
        <!-- Converters -->
        <local:PositiveConverter x:Key="PositiveConverter"/>
        <local:NegativeConverter x:Key="NegativeConverter"/>

        <!-- Modern UI Styles -->
        <Style x:Key="ModernCard" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" BlurRadius="6" Opacity="0.1" ShadowDepth="3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="HeaderTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>

        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#2563EB"/>
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1D4ED8"/>
                                <Setter Property="BorderBrush" Value="#1D4ED8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1E40AF"/>
                                <Setter Property="BorderBrush" Value="#1E40AF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#E5E7EB"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#F9FAFB"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ColumnHeaderStyle">
                <Setter.Value>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F3F4F6"/>
                        <Setter Property="Foreground" Value="#374151"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="12,8"/>
                        <Setter Property="BorderBrush" Value="#E5E7EB"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Value Converters for Colors -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸ“Š" FontSize="32" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <StackPanel>
                        <TextBlock Text="Analisi Avanzate" Style="{StaticResource HeaderTitle}" Margin="0"/>
                        <TextBlock Text="Analizza i tuoi dati finanziari con grafici e confronti dettagliati"
                                   FontSize="14"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <Button Grid.Column="1"
                        x:Name="BtnHelp"
                        Content="â“ Guida"
                        Style="{StaticResource ModernButton}"
                        Click="BtnHelp_Click"/>
            </Grid>
        </Border>

        <!-- Main Content with Tabs -->
        <TabControl Grid.Row="1"
                    x:Name="MainTabControl"
                    Background="Transparent"
                    BorderThickness="0"
                    Margin="16"
                    SelectionChanged="MainTabControl_SelectionChanged">

            <!-- TAB 1: Analisi per Anno -->
            <TabItem Header="ðŸ“… Analisi per Anno" FontSize="14" FontWeight="SemiBold">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Anno Selection -->
                        <Border Grid.Row="0" Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="Seleziona Anno" Style="{StaticResource SectionTitle}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox Grid.Column="0"
                                              x:Name="CmbAnnoAnalisi"
                                              Style="{StaticResource ModernComboBox}"/>

                                    <TextBlock Grid.Column="1"
                                               x:Name="TxtAnnoInfo"
                                               Text="Seleziona un anno per visualizzare l'analisi dei 12 periodi stipendiali"
                                               FontStyle="Italic"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               VerticalAlignment="Center"
                                               Margin="16,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Dettaglio Periodi (Prima Sezione) -->
                        <Border Grid.Row="1" Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Dettaglio Periodi Stipendiali" Style="{StaticResource SectionTitle}"/>
                                    <Button Grid.Column="1" x:Name="BtnEsportaPeriodi"
                                            Content="ðŸ“¤ Esporta Periodi"
                                            Style="{StaticResource ModernButton}"
                                            Background="#10B981"
                                            Margin="8,0,0,0"
                                            Click="BtnEsportaPeriodiStipendiali_Click"/>
                                </Grid>
                                <DataGrid x:Name="DgAnno"
                                          Style="{StaticResource ModernDataGrid}"
                                          Height="280">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Periodo Inizio" Binding="{Binding DataInizio, StringFormat=dd/MM/yyyy}" Width="120"/>
                                        <DataGridTextColumn Header="Periodo Fine" Binding="{Binding DataFine, StringFormat=dd/MM/yyyy}" Width="120"/>
                                        <DataGridTextColumn Header="Mese" Binding="{Binding MeseAnno}" Width="150"/>
                                        <DataGridTextColumn Header="Entrate" Binding="{Binding Entrate, StringFormat=C2}" Width="120">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Uscite" Binding="{Binding Uscite, StringFormat=C2}" Width="120">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Risparmio" Binding="{Binding Risparmio, StringFormat=C2}" Width="120">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsRisparmioPositivo}" Value="True">
                                                            <Setter Property="Foreground" Value="Green"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsRisparmioPositivo}" Value="False">
                                                            <Setter Property="Foreground" Value="Red"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>

                        <!-- Grafici Annuali (Seconda Sezione) -->
                        <Border Grid.Row="2" Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Grafici Annuali" Style="{StaticResource SectionTitle}"/>
                                    <Button Grid.Column="1" x:Name="BtnEsportaGrafici"
                                            Content="ðŸ“Š Esporta Grafici"
                                            Style="{StaticResource ModernButton}"
                                            Background="#2563EB"
                                            Margin="8,0,0,0"
                                            Click="BtnEsportaGrafici_Click"/>
                                </Grid>
                                <TabControl x:Name="TabGraficiAnno" Height="250" Background="Transparent">
                                    <TabItem Header="ðŸ“Š Panoramica">
                                        <TextBlock x:Name="PlotPanoramica"
                                                   Text="ðŸ“Š Grafico Panoramica&#10;[Implementazione in corso]"
                                                   Background="{DynamicResource SurfaceBrush}"
                                                   TextAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Padding="20"
                                                   FontSize="14"/>
                                    </TabItem>
                                    <TabItem Header="ðŸ“ˆ Andamento">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                                            <TextBlock x:Name="PlotAndamento"
                                                       Text="ðŸ“ˆ Grafico Andamento&#10;[Implementazione in corso]"
                                                       Background="White"
                                                       TextAlignment="Left"
                                                       VerticalAlignment="Top"
                                                       Padding="15"
                                                       FontSize="12"
                                                       FontFamily="Consolas"
                                                       TextWrapping="NoWrap"/>
                                        </ScrollViewer>
                                    </TabItem>
                                    <TabItem Header="ðŸ¥§ Distribuzione">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                                            <TextBlock x:Name="PlotDistribuzione"
                                                       Text="ðŸ¥§ Grafico Distribuzione&#10;[Implementazione in corso]"
                                                       Background="White"
                                                       TextAlignment="Left"
                                                       VerticalAlignment="Top"
                                                       Padding="15"
                                                       FontSize="12"
                                                       FontFamily="Consolas"
                                                       TextWrapping="NoWrap"/>
                                        </ScrollViewer>
                                    </TabItem>
                                </TabControl>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- TAB 2: Analisi per Categorie -->
            <TabItem Header="ðŸ·ï¸ Analisi per Categorie" FontSize="14" FontWeight="SemiBold">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Filtri Categorie -->
                        <Border Grid.Row="0" Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="Filtri di Ricerca" Style="{StaticResource SectionTitle}"/>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Prima riga -->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,0">
                                        <TextBlock Text="Anno" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="CmbAnnoCategorie"
                                                  Style="{StaticResource ModernComboBox}"
                                                  SelectionChanged="CmbAnnoCategorie_SelectionChanged"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0">
                                        <TextBlock Text="Mese" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="CmbMeseCategorie"
                                                  Style="{StaticResource ModernComboBox}"
                                                  SelectionChanged="CmbMeseCategorie_SelectionChanged"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="0" Grid.Column="2" Margin="8,0">
                                        <TextBlock Text="Macro Categoria" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="CmbMacroCategoria"
                                                  Style="{StaticResource ModernComboBox}"
                                                  SelectionChanged="CmbMacroCategoria_SelectionChanged"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="0" Grid.Column="3" Margin="8,0,0,0">
                                        <TextBlock Text="Categoria" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="CmbCategoria"
                                                  Style="{StaticResource ModernComboBox}"
                                                  SelectionChanged="CmbCategoria_SelectionChanged"/>
                                    </StackPanel>

                                    <!-- Seconda riga con pulsanti -->
                                    <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4"
                                                Orientation="Horizontal"
                                                Margin="0,16,0,0">
                                        <Button x:Name="BtnApplicaFiltri"
                                                Content="ðŸ” Applica Filtri"
                                                Style="{StaticResource ModernButton}"
                                                Click="BtnApplicaFiltri_Click"/>
                                        <Button x:Name="BtnResetFiltri"
                                                Content="ðŸ”„ Reset"
                                                Style="{StaticResource ModernButton}"
                                                Background="#10B981"
                                                Margin="8,0,0,0"
                                                Click="BtnResetFiltri_Click"/>
                                        <Button x:Name="BtnGraficiLive"
                                                Style="{StaticResource ModernButton}"
                                                Content="ðŸ“Š Apri Grafici Live"
                                                Margin="16,0,8,0"
                                                Click="BtnGraficiLive_Click"/>
                                        <Button x:Name="BtnEsportaDati"
                                                Style="{StaticResource ModernButton}"
                                                Content="ðŸ’¾ Esporta Dati"
                                                Margin="0,0,0,0"
                                                Click="BtnEsportaDati_Click"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Griglia Categorie -->
                        <Border Grid.Row="1" Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="Risultati per Categorie" Style="{StaticResource SectionTitle}"/>
                                <TextBlock x:Name="TxtLoadingCategorie"
                                           Text="â³ Caricamento dati in corso..."
                                           FontSize="14" FontStyle="Italic"
                                           Foreground="Gray" Margin="0,10"
                                           HorizontalAlignment="Center"
                                           Visibility="Collapsed"/>
                                <DataGrid x:Name="DgCategorie"
                                          Style="{StaticResource ModernDataGrid}"
                                          Height="350"
                                          MouseDoubleClick="DgCategorie_MouseDoubleClick">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Mese" Binding="{Binding Mese}" Width="120"/>
                                        <DataGridTextColumn Header="Macro Categoria" Binding="{Binding MacroCategoriaDisplay}" Width="150"/>
                                        <DataGridTextColumn Header="Categoria" Binding="{Binding CategoriaDisplay}" Width="150"/>
                                        <DataGridTextColumn Header="Entrate" Binding="{Binding Entrate, StringFormat=C2}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Uscite" Binding="{Binding Uscite, StringFormat=C2}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Risparmio" Binding="{Binding Risparmio, StringFormat=C2}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsRisparmioPositivo}" Value="True">
                                                            <Setter Property="Foreground" Value="Green"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsRisparmioPositivo}" Value="False">
                                                            <Setter Property="Foreground" Value="Red"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Riquadro Totali -->
                                <Border Style="{StaticResource ModernCard}" Margin="0,10,0,0">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“Š Riepilogo Live" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,8"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Totale Entrate -->
                                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                <TextBlock Text="ðŸ’° Entrate Totali" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                                                <TextBlock x:Name="TxtTotaleEntrate" Text="â‚¬ 0,00" FontSize="16" FontWeight="Bold"
                                                          Foreground="Green" HorizontalAlignment="Center"/>
                                            </StackPanel>

                                            <!-- Totale Uscite -->
                                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                <TextBlock Text="ðŸ’¸ Uscite Totali" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                                                <TextBlock x:Name="TxtTotaleUscite" Text="â‚¬ 0,00" FontSize="16" FontWeight="Bold"
                                                          Foreground="Red" HorizontalAlignment="Center"/>
                                            </StackPanel>

                                            <!-- Risparmio Totale -->
                                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                <TextBlock Text="ðŸ“ˆ Risparmio Totale" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                                                <TextBlock x:Name="TxtTotaleRisparmio" Text="â‚¬ 0,00" FontSize="16" FontWeight="Bold"
                                                          Foreground="Blue" HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!-- Spazio per eventuali visualizzazioni future -->
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- TAB 3: Confronto tra Anni -->
            <TabItem Header="ðŸ†š Confronto" FontSize="14" FontWeight="SemiBold">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">
                        <!-- SEZIONE 1: CONFRONTO ANNI -->
                        <Border Style="{StaticResource ModernCard}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="ðŸ“Š Confronto tra Anni" Style="{StaticResource SectionTitle}"/>

                                <!-- ModalitÃ  Anni -->
                                <Grid x:Name="GridAnni" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Anno 1" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="CmbAnno1" Style="{StaticResource ModernComboBox}"
                                                  SelectionChanged="CmbAnno1_SelectionChanged"/>
                                    </StackPanel>

                                    <Button Grid.Column="1"
                                            x:Name="BtnInvertiAnni"
                                            Content="â‡„"
                                            Width="40" Height="36"
                                            Style="{StaticResource ModernButton}"
                                            Background="#10B981"
                                            Margin="16,20,16,0"
                                            ToolTip="Inverti gli anni"
                                            Click="BtnInvertiAnni_Click"/>

                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Anno 2" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <ComboBox x:Name="CmbAnno2" Style="{StaticResource ModernComboBox}"
                                                  SelectionChanged="CmbAnno2_SelectionChanged"/>
                                    </StackPanel>

                                    <Button Grid.Column="3"
                                            x:Name="BtnConfronta"
                                            Content="âš–ï¸ Confronta"
                                            Style="{StaticResource ModernButton}"
                                            Margin="16,20,0,0"
                                            Click="BtnConfronta_Click"/>
                                </Grid>

                                <!-- Griglia Confronto Anni -->
                                <TextBlock x:Name="TxtTitoloConfrontoAnni" Text="Risultati Confronto Anni" Style="{StaticResource SectionTitle}" Margin="0,16,0,8"/>
                                <DataGrid x:Name="DgConfrontoAnni"
                                          Style="{StaticResource ModernDataGrid}"
                                          Height="220"
                                          AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <!-- Informazioni di base -->
                                        <DataGridTextColumn Header="Periodo" Binding="{Binding Periodo}" Width="120"/>

                                        <!-- Gruppo Entrate -->
                                        <DataGridTextColumn x:Name="ColEntrate1" Header="Entrate 2024" Binding="{Binding Entrate1, StringFormat=C2}" Width="110">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn x:Name="ColEntrate2" Header="Entrate 2025" Binding="{Binding Entrate2, StringFormat=C2}" Width="110">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Î” Entrate" Binding="{Binding DifferenzaEntrate, StringFormat=C2}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding DifferenzaEntrate, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding DifferenzaEntrate, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                        <!-- Gruppo Uscite -->
                                        <DataGridTextColumn x:Name="ColUscite1" Header="Uscite 2024" Binding="{Binding Uscite1, StringFormat=C2}" Width="110">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn x:Name="ColUscite2" Header="Uscite 2025" Binding="{Binding Uscite2, StringFormat=C2}" Width="110">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Î” Uscite" Binding="{Binding DifferenzaUscite, StringFormat=C2}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding DifferenzaUscite, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding DifferenzaUscite, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                        <!-- Gruppo Bilanci -->
                                        <DataGridTextColumn x:Name="ColBilancio1" Header="Bilancio 2024" Binding="{Binding Bilancio1, StringFormat=C2}" Width="110">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Bilancio1, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Bilancio1, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn x:Name="ColBilancio2" Header="Bilancio 2025" Binding="{Binding Bilancio2, StringFormat=C2}" Width="110">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Bilancio2, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Bilancio2, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Pulsante Esporta Excel -->
                                <Button x:Name="BtnEsportaConfrontoAnni"
                                        Content="ðŸ“Š Esporta in Excel"
                                        Style="{StaticResource ModernButton}"
                                        Background="#2196F3"
                                        Width="180"
                                        Height="35"
                                        Margin="0,12,0,8"
                                        HorizontalAlignment="Right"
                                        Click="BtnEsportaConfrontoAnni_Click"/>

                                <!-- Totali Confronto Anni -->
                                <Grid Margin="0,16,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Totali Anno 1 -->
                                    <Border Grid.Column="0"
                                            Style="{StaticResource ModernCard}"
                                            Background="#F8F9FA"
                                            Margin="0,0,8,0">
                                        <StackPanel>
                                            <TextBlock x:Name="TxtTitolo1"
                                                       Text="Totali 2024"
                                                       FontSize="16"
                                                       FontWeight="Bold"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,0,0,12"
                                                       Foreground="#2196F3"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <TextBlock Text="Entrate:" FontWeight="SemiBold" Width="70"/>
                                                <TextBlock x:Name="TxtEntrate1" Text="â‚¬0,00" Foreground="Green" FontWeight="SemiBold"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <TextBlock Text="Uscite:" FontWeight="SemiBold" Width="70"/>
                                                <TextBlock x:Name="TxtUscite1" Text="â‚¬0,00" Foreground="Red" FontWeight="SemiBold"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <TextBlock Text="Bilancio:" FontWeight="SemiBold" Width="70"/>
                                                <TextBlock x:Name="TxtBilancio1" Text="â‚¬0,00" FontWeight="Bold" FontSize="14"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Totali Anno 2 -->
                                    <Border Grid.Column="1"
                                            Style="{StaticResource ModernCard}"
                                            Background="#F8F9FA"
                                            Margin="8,0,0,0">
                                        <StackPanel>
                                            <TextBlock x:Name="TxtTitolo2"
                                                       Text="Totali 2025"
                                                       FontSize="16"
                                                       FontWeight="Bold"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,0,0,12"
                                                       Foreground="#2196F3"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <TextBlock Text="Entrate:" FontWeight="SemiBold" Width="70"/>
                                                <TextBlock x:Name="TxtEntrate2" Text="â‚¬0,00" Foreground="Green" FontWeight="SemiBold"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <TextBlock Text="Uscite:" FontWeight="SemiBold" Width="70"/>
                                                <TextBlock x:Name="TxtUscite2" Text="â‚¬0,00" Foreground="Red" FontWeight="SemiBold"/>
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <TextBlock Text="Bilancio:" FontWeight="SemiBold" Width="70"/>
                                                <TextBlock x:Name="TxtBilancio2" Text="â‚¬0,00" FontWeight="Bold" FontSize="14"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- SEZIONE 2: PERIODI PERSONALIZZATI -->
                        <Border Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock Text="ðŸ“… Confronto Periodi Personalizzati" Style="{StaticResource SectionTitle}"/>

                                <!-- Controlli Periodi -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Periodo 1 -->
                                    <Grid Grid.Row="0" Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="120"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Periodo 1 - Da:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <DatePicker Grid.Column="1" x:Name="DpPeriodo1Da" Margin="0,0,8,0"
                                                    SelectedDateChanged="DpPeriodo_SelectedDateChanged"/>
                                        <TextBlock Grid.Column="2" Text="A:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <DatePicker Grid.Column="3" x:Name="DpPeriodo1A" Margin="0,0,16,0"
                                                    SelectedDateChanged="DpPeriodo_SelectedDateChanged"/>
                                    </Grid>

                                    <!-- Periodo 2 -->
                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Periodo 2 - Da:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <DatePicker Grid.Column="1" x:Name="DpPeriodo2Da" Margin="0,0,8,0"
                                                    SelectedDateChanged="DpPeriodo_SelectedDateChanged"/>
                                        <TextBlock Grid.Column="2" Text="A:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0"/>
                                        <DatePicker Grid.Column="3" x:Name="DpPeriodo2A" Margin="0,0,16,0"
                                                    SelectedDateChanged="DpPeriodo_SelectedDateChanged"/>

                                        <StackPanel Grid.Column="4" Orientation="Horizontal">
                                            <Button Content="âš–ï¸ Confronta Periodi" Style="{StaticResource ModernButton}" Click="BtnConfrontaPeriodi_Click"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>

                                <!-- Griglia Confronto Periodi -->
                                <TextBlock x:Name="TxtTitoloPeriodi" Text="Risultati Confronto Periodi" Style="{StaticResource SectionTitle}" Margin="0,16,0,8"/>
                                <DataGrid x:Name="DgConfrontoPeriodi"
                                          Style="{StaticResource ModernDataGrid}"
                                          Height="120"
                                          AutoGenerateColumns="False">
                                    <DataGrid.Columns>
                                        <!-- Gruppo Entrate -->
                                        <DataGridTextColumn Header="Entrate 1" Binding="{Binding Entrate1, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Entrate 2" Binding="{Binding Entrate2, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Î” Entrate" Binding="{Binding DifferenzaEntrate, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding DifferenzaEntrate, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding DifferenzaEntrate, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                        <!-- Gruppo Uscite -->
                                        <DataGridTextColumn Header="Uscite 1" Binding="{Binding Uscite1, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Uscite 2" Binding="{Binding Uscite2, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Î” Uscite" Binding="{Binding DifferenzaUscite, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding DifferenzaUscite, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding DifferenzaUscite, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>

                                        <!-- Gruppo Bilancio -->
                                        <DataGridTextColumn Header="Bilancio 1" Binding="{Binding Bilancio1, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Bilancio1, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Bilancio1, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Bilancio 2" Binding="{Binding Bilancio2, StringFormat=C2}" Width="90">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Bilancio2, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Bilancio2, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Î” Bilancio" Binding="{Binding DifferenzaBilancio, StringFormat=C2}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                    <Setter Property="FontSize" Value="14"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding DifferenzaBilancio, Converter={StaticResource PositiveConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkGreen"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding DifferenzaBilancio, Converter={StaticResource NegativeConverter}}" Value="True">
                                                            <Setter Property="Foreground" Value="DarkRed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Pulsante Esporta Excel -->
                                <Button x:Name="BtnEsportaPeriodiPersonalizzati"
                                        Content="ðŸ“Š Esporta in Excel"
                                        Style="{StaticResource ModernButton}"
                                        Background="#2196F3"
                                        Width="180"
                                        Height="35"
                                        Margin="0,12,0,8"
                                        HorizontalAlignment="Right"
                                        Click="BtnEsportaPeriodi_Click"/>
                            </StackPanel>
                        </Border>

                        <!-- Sintesi Periodi -->
                        <Border Grid.Row="2" Style="{StaticResource ModernCard}">
                            <StackPanel>
                                <TextBlock x:Name="TxtTitoloSintesiPeriodi"
                                           Text="ðŸ“Š Sintesi Periodi Personalizzati"
                                           Style="{StaticResource SectionTitle}"/>
                                <TextBlock x:Name="TxtSintesiPeriodi"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           TextWrapping="Wrap"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Loading Overlay -->
        <Border x:Name="LoadingOverlay" Background="#80000000" Visibility="Collapsed" Grid.RowSpan="3">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock x:Name="TxtLoadingMessage" Text="Caricamento..." FontSize="18" FontWeight="Bold"
                          Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="6"
                            Background="Transparent" Foreground="#2196F3"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>